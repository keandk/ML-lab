var _0x3fe2=['access_token','userId','_csrf','getSetAccessToken','this\x20is\x20a\x20super\x20secret\x20string','This\x20is\x20not\x20correct\x20secret','now','123abc','456def','return\x20`no\x20token`\x20error\x20if\x20no\x20token\x20is\x20found','error','toEqual','noTokenFound','cookies','sign','returns\x20`expired\x20token`\x20error\x20for\x20expired\x20tokens','expiredToken','returns\x20a\x20valid\x20access\x20token\x20with\x20no\x20errors\x20','toBeFalsy','accessToken','returns\x20the\x20signed\x20jwt\x20if\x20found','jwt','invalidToken','assertions','toISOString','setAccessTokenToResponse','sets\x20a\x20jwt\x20access\x20token\x20cookie\x20in\x20the\x20response','cookie','getCall','args','localhost','ttl','removeCookies','removes\x20four\x20cookies\x20set\x20in\x20the\x20lifetime\x20of\x20an\x20authenticated\x20session','clearCookie'];(function(_0x29bfdc,_0x10be6e){var _0x2e3d24=function(_0x2a4660){while(--_0x2a4660){_0x29bfdc['push'](_0x29bfdc['shift']());}};_0x2e3d24(++_0x10be6e);}(_0x3fe2,0x13e));var _0x7791=function(_0x5bb1f7,_0x39744b){_0x5bb1f7=_0x5bb1f7-0x0;var _0x46c58c=_0x3fe2[_0x5bb1f7];return _0x46c58c;};import{getAccessTokenFromRequest,errorTypes,setAccessTokenToResponse,removeCookies}from'./getSetAccessToken';import{mockReq,mockRes}from'sinon-express-mock';import _0x1e6b12 from'jsonwebtoken';describe(_0x7791('0x0'),()=>{const validJWTSecret=_0x7791('0x1');const invalidJWTSecret=_0x7791('0x2');const now=new Date(Date[_0x7791('0x3')]());const theBeginningOfTime=new Date(0x0);const accessToken={'id':_0x7791('0x4'),'userId':_0x7791('0x5'),'ttl':0xea60,'created':now};describe('getAccessTokenFromRequest',()=>{it(_0x7791('0x6'),()=>{const req=mockReq({'headers':{},'cookie':{}});const result=getAccessTokenFromRequest(req,validJWTSecret);expect(result[_0x7791('0x7')])[_0x7791('0x8')](errorTypes[_0x7791('0x9')]);});describe(_0x7791('0xa'),()=>{it('returns\x20`invalid\x20token`\x20error\x20for\x20malformed\x20tokens',()=>{const invalidJWT=_0x1e6b12[_0x7791('0xb')]({'accessToken':accessToken},invalidJWTSecret);const req=mockReq({'cookie':{'jwt_access_token':invalidJWT}});const result=getAccessTokenFromRequest(req,validJWTSecret);expect(result[_0x7791('0x7')])['toEqual'](errorTypes['invalidToken']);});it(_0x7791('0xc'),()=>{const invalidJWT=_0x1e6b12[_0x7791('0xb')]({'accessToken':{...accessToken,'created':theBeginningOfTime}},validJWTSecret);const req=mockReq({'cookie':{'jwt_access_token':invalidJWT}});const result=getAccessTokenFromRequest(req,validJWTSecret);expect(result[_0x7791('0x7')])['toEqual'](errorTypes[_0x7791('0xd')]);});it(_0x7791('0xe'),()=>{expect['assertions'](0x2);const validJWT=_0x1e6b12[_0x7791('0xb')]({'accessToken':accessToken},validJWTSecret);const req=mockReq({'cookie':{'jwt_access_token':validJWT}});const result=getAccessTokenFromRequest(req,validJWTSecret);expect(result['error'])[_0x7791('0xf')]();expect(result[_0x7791('0x10')])['toEqual']({...accessToken,'created':accessToken['created']['toISOString']()});});it(_0x7791('0x11'),()=>{const validJWT=_0x1e6b12[_0x7791('0xb')]({'accessToken':accessToken},validJWTSecret);const req=mockReq({'cookie':{'jwt_access_token':validJWT}});const result=getAccessTokenFromRequest(req,validJWTSecret);expect(result[_0x7791('0x12')])['toEqual'](validJWT);});});describe('Auth\x20headers',()=>{it('returns\x20`invalid\x20token`\x20error\x20for\x20malformed\x20tokens',()=>{const invalidJWT=_0x1e6b12[_0x7791('0xb')]({'accessToken':accessToken},invalidJWTSecret);const req=mockReq({'headers':{'X-fcc-access-token':invalidJWT}});const result=getAccessTokenFromRequest(req,validJWTSecret);expect(result['error'])[_0x7791('0x8')](errorTypes[_0x7791('0x13')]);});it(_0x7791('0xc'),()=>{const invalidJWT=_0x1e6b12['sign']({'accessToken':{...accessToken,'created':theBeginningOfTime}},validJWTSecret);const req=mockReq({'headers':{'X-fcc-access-token':invalidJWT}});const result=getAccessTokenFromRequest(req,validJWTSecret);expect(result[_0x7791('0x7')])['toEqual'](errorTypes['expiredToken']);});it(_0x7791('0xe'),()=>{expect[_0x7791('0x14')](0x2);const validJWT=_0x1e6b12[_0x7791('0xb')]({'accessToken':accessToken},validJWTSecret);const req=mockReq({'headers':{'X-fcc-access-token':validJWT}});const result=getAccessTokenFromRequest(req,validJWTSecret);expect(result[_0x7791('0x7')])['toBeFalsy']();expect(result[_0x7791('0x10')])['toEqual']({...accessToken,'created':accessToken['created'][_0x7791('0x15')]()});});it(_0x7791('0x11'),()=>{const validJWT=_0x1e6b12['sign']({'accessToken':accessToken},validJWTSecret);const req=mockReq({'headers':{'X-fcc-access-token':validJWT}});const result=getAccessTokenFromRequest(req,validJWTSecret);expect(result[_0x7791('0x12')])[_0x7791('0x8')](validJWT);});});});describe(_0x7791('0x16'),()=>{it(_0x7791('0x17'),()=>{const req=mockReq();const res=mockRes();const expectedJWT=_0x1e6b12['sign']({'accessToken':accessToken},validJWTSecret);setAccessTokenToResponse({'accessToken':accessToken},req,res,validJWTSecret);expect(res[_0x7791('0x18')][_0x7791('0x19')](0x0)[_0x7791('0x1a')])[_0x7791('0x8')](['jwt_access_token',expectedJWT,{'signed':![],'domain':_0x7791('0x1b'),'maxAge':accessToken[_0x7791('0x1c')]}]);});});describe(_0x7791('0x1d'),()=>{it(_0x7791('0x1e'),()=>{const req=mockReq();const res=mockRes();removeCookies(req,res);expect(res[_0x7791('0x1f')][_0x7791('0x19')](0x0)[_0x7791('0x1a')])[_0x7791('0x8')](['jwt_access_token',{'signed':![],'domain':_0x7791('0x1b')}]);expect(res[_0x7791('0x1f')][_0x7791('0x19')](0x1)[_0x7791('0x1a')])[_0x7791('0x8')]([_0x7791('0x20'),{'signed':![],'domain':_0x7791('0x1b')}]);expect(res[_0x7791('0x1f')][_0x7791('0x19')](0x2)[_0x7791('0x1a')])[_0x7791('0x8')]([_0x7791('0x21'),{'signed':![],'domain':_0x7791('0x1b')}]);expect(res[_0x7791('0x1f')][_0x7791('0x19')](0x3)[_0x7791('0x1a')])[_0x7791('0x8')]([_0x7791('0x22'),{'signed':![],'domain':_0x7791('0x1b')}]);});});});