var _0xeb7d=['No\x20token\x20found','Invalid\x20token','Token\x20timed\x20out','X-fcc-access-token','jwt_access_token','signedCookies','env','COOKIE_DOMAIN','localhost','cookie','headers','noTokenFound','invalidToken','now','expiredToken','clearCookie','userId','_csrf'];(function(_0x55db6a,_0x144f36){var _0x5360b3=function(_0xf069e7){while(--_0xf069e7){_0x55db6a['push'](_0x55db6a['shift']());}};_0x5360b3(++_0x144f36);}(_0xeb7d,0x159));var _0x3f19=function(_0x26ce89,_0x1dc49c){_0x26ce89=_0x26ce89-0x0;var _0x1800b2=_0xeb7d[_0x26ce89];return _0x1800b2;};import _0x1f5170 from'jsonwebtoken';import{isBefore}from'date-fns';import{jwtSecret as _0x5a4c4f}from'../../../config/secrets';export const authHeaderNS=_0x3f19('0x0');export const jwtCookieNS=_0x3f19('0x1');export function createCookieConfig(req){return{'signed':!!req[_0x3f19('0x2')],'domain':process[_0x3f19('0x3')][_0x3f19('0x4')]||_0x3f19('0x5')};}export function setAccessTokenToResponse({accessToken},req,res,jwtSecret=_0x5a4c4f){const cookieConfig={...createCookieConfig(req),'maxAge':accessToken['ttl']||0x121adb7000};const jwtAccess=_0x1f5170['sign']({'accessToken':accessToken},jwtSecret);res[_0x3f19('0x6')](jwtCookieNS,jwtAccess,cookieConfig);return;}export function getAccessTokenFromRequest(req,jwtSecret=_0x5a4c4f){const maybeToken=req['headers']&&req[_0x3f19('0x7')][authHeaderNS]||req['signedCookies']&&req['signedCookies'][jwtCookieNS]||req['cookie']&&req[_0x3f19('0x6')][jwtCookieNS];if(!maybeToken){return{'accessToken':null,'error':errorTypes[_0x3f19('0x8')]};}let token;try{token=_0x1f5170['verify'](maybeToken,jwtSecret);}catch(_0x389265){return{'accessToken':null,'error':errorTypes[_0x3f19('0x9')]};}const {accessToken}=token;const {created,ttl}=accessToken;const valid=isBefore(Date[_0x3f19('0xa')](),Date['parse'](created)+ttl);if(!valid){return{'accessToken':null,'error':errorTypes[_0x3f19('0xb')]};}return{'accessToken':accessToken,'error':'','jwt':maybeToken};}export function removeCookies(req,res){const config=createCookieConfig(req);res['clearCookie'](jwtCookieNS,config);res['clearCookie']('access_token',config);res[_0x3f19('0xc')](_0x3f19('0xd'),config);res[_0x3f19('0xc')](_0x3f19('0xe'),config);return;}export const errorTypes={'noTokenFound':_0x3f19('0xf'),'invalidToken':_0x3f19('0x10'),'expiredToken':_0x3f19('0x11')};